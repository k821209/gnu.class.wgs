<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ìŠµ 1: ë°ì´í„° íƒìƒ‰ ë° í’ˆì§ˆ í‰ê°€ - Python FASTQ ë¶„ì„</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body { font-family: 'Malgun Gothic', Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
        .slide { width: 100%; height: 100vh; display: block; padding: 40px; box-sizing: border-box; background: white; }
        .slide-title { font-size: 36px; font-weight: bold; color: #2c3e50; margin-bottom: 30px; border-bottom: 3px solid #f39c12; padding-bottom: 10px; }
        .slide-content { font-size: 18px; line-height: 1.6; color: #34495e; }
        .slide-content h2 { color: #f39c12; font-size: 24px; margin-top: 30px; }
        .slide-content h3 { color: #e74c3c; font-size: 20px; margin-top: 20px; }
        .slide-content ul { margin: 15px 0; padding-left: 30px; }
        .slide-content li { margin: 8px 0; }
        .highlight { background: #fff3cd; padding: 3px 8px; border-radius: 3px; }
        .code-block { background: #1e1e1e; color: #f8f8f2; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; margin: 15px 0; font-size: 14px; white-space: pre-wrap; border: 1px solid #444; position: relative; }
        .code-block-container { position: relative; }
        .copy-button { position: absolute; top: 10px; right: 10px; background: #444; color: #f8f8f2; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px; opacity: 0.7; transition: opacity 0.2s; }
        .copy-button:hover { opacity: 1; background: #555; }
        .copy-button.copied { background: #27ae60; color: white; }
        .copy-button.copied:after { content: " âœ“"; }
        
        /* Syntax highlighting color classes */
        .comment { color: #75715e; } /* Comments */
        .keyword { color: #f92672; } /* Keywords */
        .function { color: #a6e22e; } /* Function names */
        .string { color: #e6db74; } /* Strings */
        .number { color: #ae81ff; } /* Numbers */
        .param { color: #fd971f; } /* Parameters */
        .variable { color: #f8f8f2; } /* Variables */
        .builtin { color: #a6e22e; } /* Built-in functions */
        .operator { color: #f92672; } /* Operators */
        .shebang { color: #75715e; } /* Shebang */
        .navigation { position: fixed; bottom: 20px; right: 20px; z-index: 1000; }
        .nav-btn { background: #f39c12; color: white; border: none; padding: 10px 20px; margin: 0 5px; border-radius: 5px; cursor: pointer; }
        .nav-btn:hover { background: #e67e22; }
        .fullscreen-btn { background: #e74c3c; color: white; border: none; padding: 10px 15px; margin: 0 5px; border-radius: 5px; cursor: pointer; }
        .fullscreen-btn:hover { background: #c0392b; }
        .jump-btn { background: #3498db; color: white; border: none; padding: 10px 15px; margin: 0 5px; border-radius: 5px; cursor: pointer; }
        .jump-btn:hover { background: #2980b9; }
        .slide-number { position: fixed; bottom: 20px; left: 20px; color: #7f8c8d; font-size: 14px; }
        .comparison-table { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .comparison-item { background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #f39c12; }
        .comparison-item h4 { margin: 0 0 10px 0; color: #2c3e50; }
        .setup-steps { background: #e8f4fd; border-left: 4px solid #3498db; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .practical-box { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin: 20px 0; }
        .jupyter-cell { background: #ffffff; border: 1px solid #e1e4e8; border-radius: 6px; margin: 10px 0; }
        .jupyter-input { background: #f6f8fa; padding: 10px; border-bottom: 1px solid #e1e4e8; font-family: 'Courier New', monospace; font-size: 12px; }
        .jupyter-output { padding: 10px; font-family: 'Courier New', monospace; font-size: 12px; }
        .exercise-box { background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .result-box { background: #d4edda; border-left: 4px solid #28a745; padding: 20px; margin: 20px 0; border-radius: 8px; }
    </style>
</head>
<body>

<div class="slide">
    <div class="slide-title">ğŸ’» ì‹¤ìŠµ 1: ë°ì´í„° íƒìƒ‰ ë° í’ˆì§ˆ í‰ê°€</div>
    <div class="slide-content">
        <h2>ğŸ¯ ì‹¤ìŠµ ëª©í‘œ</h2>
        <p>Pythonì„ ì‚¬ìš©í•˜ì—¬ FASTQ íŒŒì¼ì„ ì§ì ‘ ë¶„ì„í•˜ê³  í’ˆì§ˆì„ í‰ê°€í•˜ëŠ” ì‹¤ìŠµì„ ì§„í–‰í•©ë‹ˆë‹¤. JupyterLab í™˜ê²½ì—ì„œ ì‹¤ì œ ì½© ê²Œë†ˆ ë°ì´í„°ë¥¼ íƒìƒ‰í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

        <div class="comparison-table">
            <div class="comparison-item">
                <h4><i class="fas fa-bullseye"></i> í•™ìŠµ ëª©í‘œ</h4>
                <ul>
                    <li>FASTQ íŒŒì¼ êµ¬ì¡° ì´í•´</li>
                    <li>Pythonìœ¼ë¡œ ì‹œí€€ì‹± ë°ì´í„° ì½ê¸°</li>
                    <li>í’ˆì§ˆ ì ìˆ˜ ë¶„ì„ ë° ì‹œê°í™”</li>
                    <li>ë¦¬ë“œ ê¸¸ì´ ë¶„í¬ í™•ì¸</li>
                    <li>GC í•¨ëŸ‰ ê³„ì‚°</li>
                </ul>
            </div>
            
            <div class="comparison-item" style="border-left-color: #e74c3c;">
                <h4><i class="fas fa-tools"></i> ì‚¬ìš© ë„êµ¬</h4>
                <ul>
                    <li><strong>Python ë¼ì´ë¸ŒëŸ¬ë¦¬:</strong> BioPython, pandas, matplotlib, seaborn</li>
                    <li><strong>ë°ì´í„°:</strong> ì½© ê²Œë†ˆ FASTQ íŒŒì¼</li>
                    <li><strong>í™˜ê²½:</strong> JupyterLab</li>
                    <li><strong>ë¶„ì„ ë°©ë²•:</strong> ì§ì ‘ íŒŒì‹± ë° í†µê³„ ë¶„ì„</li>
                </ul>
            </div>
        </div>

        <h2>ğŸ“‚ ì‹¤ìŠµ ë°ì´í„° ì¤€ë¹„</h2>
        <div class="setup-steps">
            <h3><i class="fas fa-database"></i> ë°ì´í„° ë””ë ‰í† ë¦¬ í™•ì¸</h3>
            <p>AWS EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ <code>/home/ubuntu/edu/raw_data/</code> ë””ë ‰í† ë¦¬ì— ì‹¤ìŠµìš© FASTQ íŒŒì¼ì´ ì¤€ë¹„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
            
            <div class="code-block-container">
                <div class="code-block bash">
# ë°ì´í„° ë””ë ‰í† ë¦¬ í™•ì¸
ls -la /home/ubuntu/edu/raw_data/

# íŒŒì¼ í¬ê¸° í™•ì¸
du -sh /home/ubuntu/edu/raw_data/*

# FASTQ íŒŒì¼ ì••ì¶• í™•ì¸
file /home/ubuntu/edu/raw_data/*.fastq.gz
</div>
            </div>
        </div>

        <h2>ğŸ Python ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì •</h2>
        <div class="setup-steps">
            <h3><i class="fas fa-code"></i> í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°</h3>
            <p>JupyterLabì—ì„œ ìƒˆë¡œìš´ ë…¸íŠ¸ë¶ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ê°€ì ¸ì˜µë‹ˆë‹¤:</p>
            
            <div class="code-block-container">
                <div class="code-block python">
# í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
# !pip install koreanize-matplotlib í„°ë¯¸ë„ì— ì…ë ¥í•˜ì—¬ ì„¤ì¹˜
# ì„¤ì¹˜ í›„ importë¡œ ë¶ˆëŸ¬ì˜¤ê¸°

import gzip
import os
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from collections import Counter, defaultdict
from pathlib import Path
import warnings
import koreanize_matplotlib
warnings.filterwarnings('ignore')

# ê·¸ë˜í”„ ìŠ¤íƒ€ì¼ ì„¤ì •
plt.style.use('seaborn-v0_8')
sns.set_palette("husl")

# ê·¸ë˜í”„ í¬ê¸° ê¸°ë³¸ê°’ ì„¤ì •
plt.rcParams['figure.figsize'] = (10, 6)
plt.rcParams['font.size'] = 12

print("âœ… ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!")
</div>
            </div>
        </div>

        <h2>ğŸ“Š FASTQ íŒŒì¼ ê¸°ë³¸ íƒìƒ‰</h2>
        <div class="setup-steps">
            <h3><i class="fas fa-search"></i> 1ë‹¨ê³„: íŒŒì¼ ì •ë³´ í™•ì¸</h3>
            
            <div class="code-block-container">
                <div class="code-block python">
def explore_fastq_files(data_dir):
    """FASTQ íŒŒì¼ë“¤ì˜ ê¸°ë³¸ ì •ë³´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤."""
    
    data_path = Path(data_dir)
    fastq_files = list(data_path.glob("*.fastq.gz"))
    
    print(f"ğŸ“ ë°ì´í„° ë””ë ‰í† ë¦¬: {data_dir}")
    print(f"ğŸ” ë°œê²¬ëœ FASTQ íŒŒì¼: {len(fastq_files)}ê°œ")
    print("=" * 50)
    
    file_info = []
    
    for fastq_file in sorted(fastq_files):
        # íŒŒì¼ í¬ê¸° (MB)
        file_size = fastq_file.stat().st_size / (1024 * 1024)
        
        # íŒŒì¼ ì´ë¦„ ë¶„ì„
        file_name = fastq_file.name
        is_paired = "_1.fastq.gz" in file_name or "_2.fastq.gz" in file_name
        read_type = "R1" if "_1.fastq.gz" in file_name else "R2" if "_2.fastq.gz" in file_name else "SE"
        
        file_info.append({
            'filename': file_name,
            'size_mb': file_size,
            'read_type': read_type,
            'is_paired': is_paired
        })
        
        print(f"ğŸ“„ {file_name}")
        print(f"   í¬ê¸°: {file_size:.1f} MB")
        print(f"   íƒ€ì…: {read_type} ({'Paired-End' if is_paired else 'Single-End'})")
        print()
    
    return file_info

# ì‹¤ìŠµ ë°ì´í„° íƒìƒ‰
data_directory = "/home/ubuntu/edu/raw_data"
file_info = explore_fastq_files(data_directory)
</div>
            </div>
        </div>

        <h2>ğŸ§¬ FASTQ íŒŒì¼ íŒŒì‹± ë° ë¶„ì„</h2>
        <div class="setup-steps">
            <h3><i class="fas fa-dna"></i> 2ë‹¨ê³„: FASTQ íŒŒì„œ êµ¬í˜„</h3>
            
            <div class="code-block-container">
                <div class="code-block python">
def parse_fastq_sample(fastq_file, sample_size=10000):
    """FASTQ íŒŒì¼ì—ì„œ ìƒ˜í”Œì„ ì¶”ì¶œí•˜ì—¬ ë¶„ì„í•©ë‹ˆë‹¤."""
    
    print(f"ğŸ” íŒŒì¼ ë¶„ì„: {fastq_file}")
    
    sequences = []
    quality_scores = []
    sequence_lengths = []
    gc_contents = []
    
    with gzip.open(fastq_file, 'rt') as f:
        line_count = 0
        current_seq = ""
        current_qual = ""
        
        for line in f:
            line = line.strip()
            
            # FASTQ í˜•ì‹: 4ì¤„ì”© ë°˜ë³µ
            if line_count % 4 == 0:  # Header line (@ë¡œ ì‹œì‘)
                if line_count > 0:  # ì²« ë²ˆì§¸ê°€ ì•„ë‹Œ ê²½ìš° ì´ì „ ë°ì´í„° ì €ì¥
                    sequences.append(current_seq)
                    quality_scores.append(current_qual)
                    sequence_lengths.append(len(current_seq))
                    
                    # GC í•¨ëŸ‰ ê³„ì‚°
                    gc_count = current_seq.count('G') + current_seq.count('C')
                    gc_content = gc_count / len(current_seq) * 100
                    gc_contents.append(gc_content)
                    
                    # ìƒ˜í”Œ í¬ê¸° ë„ë‹¬ ì‹œ ì¤‘ë‹¨
                    if len(sequences) >= sample_size:
                        break
                        
            elif line_count % 4 == 1:  # Sequence line
                current_seq = line
            elif line_count % 4 == 3:  # Quality line
                current_qual = line
            
            line_count += 1
    
    # ë§ˆì§€ë§‰ ì‹œí€€ìŠ¤ ì²˜ë¦¬
    if current_seq and len(sequences) < sample_size:
        sequences.append(current_seq)
        quality_scores.append(current_qual)
        sequence_lengths.append(len(current_seq))
        gc_count = current_seq.count('G') + current_seq.count('C')
        gc_content = gc_count / len(current_seq) * 100
        gc_contents.append(gc_content)
    
    print(f"ğŸ“Š ë¶„ì„ ì™„ë£Œ: {len(sequences)}ê°œ ì‹œí€€ìŠ¤")
    
    return {
        'sequences': sequences,
        'quality_scores': quality_scores,
        'sequence_lengths': sequence_lengths,
        'gc_contents': gc_contents
    }

# ì²« ë²ˆì§¸ FASTQ íŒŒì¼ ë¶„ì„
if file_info:
    first_file = Path(data_directory) / file_info[0]['filename']
    sample_data = parse_fastq_sample(first_file, sample_size=5000)
    
    print(f"\nğŸ“ˆ ë¶„ì„ ê²°ê³¼:")
    print(f"   í‰ê·  ë¦¬ë“œ ê¸¸ì´: {np.mean(sample_data['sequence_lengths']):.1f} bp")
    print(f"   í‰ê·  GC í•¨ëŸ‰: {np.mean(sample_data['gc_contents']):.1f}%")
</div>
            </div>
        </div>

        <h2>ğŸ“Š í’ˆì§ˆ ì ìˆ˜ ë¶„ì„</h2>
        <div class="setup-steps">
            <h3><i class="fas fa-chart-line"></i> 3ë‹¨ê³„: í’ˆì§ˆ ì ìˆ˜ ì‹œê°í™”</h3>
            
            <div class="code-block-container">
                <div class="code-block python">
def analyze_quality_scores(quality_scores):
    """í’ˆì§ˆ ì ìˆ˜ë¥¼ ë¶„ì„í•˜ê³  ì‹œê°í™”í•©ë‹ˆë‹¤."""
    
    print("ğŸ“Š í’ˆì§ˆ ì ìˆ˜ ë¶„ì„ ì¤‘...")
    
    # í’ˆì§ˆ ì ìˆ˜ë¥¼ ìˆ«ìë¡œ ë³€í™˜ (ASCII - 33)
    quality_matrices = []
    
    for qual_string in quality_scores:
        qual_nums = [ord(char) - 33 for char in qual_string]
        quality_matrices.append(qual_nums)
    
    # ìœ„ì¹˜ë³„ í’ˆì§ˆ ì ìˆ˜ ê³„ì‚°
    max_length = max(len(qual) for qual in quality_matrices)
    position_qualities = defaultdict(list)
    
    for qual_list in quality_matrices:
        for pos, qual in enumerate(qual_list):
            position_qualities[pos].append(qual)
    
    # ìœ„ì¹˜ë³„ í‰ê·  í’ˆì§ˆ ê³„ì‚°
    positions = []
    mean_qualities = []
    q25_qualities = []
    q75_qualities = []
    
    for pos in range(max_length):
        if pos in position_qualities:
            quals = position_qualities[pos]
            positions.append(pos + 1)  # 1-based indexing
            mean_qualities.append(np.mean(quals))
            q25_qualities.append(np.percentile(quals, 25))
            q75_qualities.append(np.percentile(quals, 75))
    
    # ì‹œê°í™”
    fig, axes = plt.subplots(2, 2, figsize=(15, 10))
    
    # 1. ìœ„ì¹˜ë³„ í’ˆì§ˆ ì ìˆ˜
    axes[0, 0].plot(positions, mean_qualities, 'b-', linewidth=2, label='í‰ê· ')
    axes[0, 0].fill_between(positions, q25_qualities, q75_qualities, alpha=0.3, label='25-75 ë°±ë¶„ìœ„')
    axes[0, 0].axhline(y=20, color='r', linestyle='--', label='Q20 (99% ì •í™•ë„)')
    axes[0, 0].axhline(y=30, color='g', linestyle='--', label='Q30 (99.9% ì •í™•ë„)')
    axes[0, 0].set_xlabel('ì—¼ê¸° ìœ„ì¹˜')
    axes[0, 0].set_ylabel('í’ˆì§ˆ ì ìˆ˜')
    axes[0, 0].set_title('ìœ„ì¹˜ë³„ í’ˆì§ˆ ì ìˆ˜')
    axes[0, 0].legend()
    axes[0, 0].grid(True, alpha=0.3)
    
    # 2. í’ˆì§ˆ ì ìˆ˜ íˆìŠ¤í† ê·¸ë¨
    all_qualities = [q for qual_list in quality_matrices for q in qual_list]
    axes[0, 1].hist(all_qualities, bins=50, alpha=0.7, color='skyblue', edgecolor='black')
    axes[0, 1].axvline(x=20, color='r', linestyle='--', label='Q20')
    axes[0, 1].axvline(x=30, color='g', linestyle='--', label='Q30')
    axes[0, 1].set_xlabel('í’ˆì§ˆ ì ìˆ˜')
    axes[0, 1].set_ylabel('ë¹ˆë„')
    axes[0, 1].set_title('í’ˆì§ˆ ì ìˆ˜ ë¶„í¬')
    axes[0, 1].legend()
    
    # 3. ë¦¬ë“œë³„ í‰ê·  í’ˆì§ˆ
    read_avg_qualities = [np.mean(qual_list) for qual_list in quality_matrices]
    axes[1, 0].hist(read_avg_qualities, bins=30, alpha=0.7, color='lightgreen', edgecolor='black')
    axes[1, 0].axvline(x=20, color='r', linestyle='--', label='Q20')
    axes[1, 0].axvline(x=30, color='g', linestyle='--', label='Q30')
    axes[1, 0].set_xlabel('ë¦¬ë“œ í‰ê·  í’ˆì§ˆ ì ìˆ˜')
    axes[1, 0].set_ylabel('ë¦¬ë“œ ìˆ˜')
    axes[1, 0].set_title('ë¦¬ë“œë³„ í‰ê·  í’ˆì§ˆ ë¶„í¬')
    axes[1, 0].legend()
    
    # 4. í’ˆì§ˆ ì ìˆ˜ ë°•ìŠ¤í”Œë¡¯ (ìœ„ì¹˜ë³„)
    box_data = []
    box_positions = []
    step = max(1, len(positions) // 20)  # ìµœëŒ€ 20ê°œ ìœ„ì¹˜ë§Œ í‘œì‹œ
    
    for i in range(0, len(positions), step):
        pos = positions[i]
        if pos - 1 in position_qualities:
            box_data.append(position_qualities[pos - 1])
            box_positions.append(pos)
    
    axes[1, 1].boxplot(box_data, positions=box_positions, widths=step*0.8)
    axes[1, 1].axhline(y=20, color='r', linestyle='--', label='Q20')
    axes[1, 1].axhline(y=30, color='g', linestyle='--', label='Q30')
    axes[1, 1].set_xlabel('ì—¼ê¸° ìœ„ì¹˜')
    axes[1, 1].set_ylabel('í’ˆì§ˆ ì ìˆ˜')
    axes[1, 1].set_title('ìœ„ì¹˜ë³„ í’ˆì§ˆ ì ìˆ˜ ë¶„í¬')
    axes[1, 1].legend()
    
    plt.tight_layout()
    plt.show()
    
    # í†µê³„ ìš”ì•½
    print(f"\nğŸ“Š í’ˆì§ˆ ì ìˆ˜ í†µê³„:")
    print(f"   ì „ì²´ í‰ê·  í’ˆì§ˆ: {np.mean(all_qualities):.2f}")
    print(f"   Q20 ì´ìƒ ë¹„ìœ¨: {np.mean(np.array(all_qualities) >= 20) * 100:.1f}%")
    print(f"   Q30 ì´ìƒ ë¹„ìœ¨: {np.mean(np.array(all_qualities) >= 30) * 100:.1f}%")
    print(f"   ë¦¬ë“œ í‰ê·  í’ˆì§ˆ: {np.mean(read_avg_qualities):.2f}")
    
    return {
        'mean_qualities': mean_qualities,
        'all_qualities': all_qualities,
        'read_avg_qualities': read_avg_qualities
    }

# í’ˆì§ˆ ì ìˆ˜ ë¶„ì„ ì‹¤í–‰
quality_analysis = analyze_quality_scores(sample_data['quality_scores'])
</div>
            </div>
        </div>

        <h2>ğŸ§® ì„œì—´ ì¡°ì„± ë¶„ì„</h2>
        <div class="setup-steps">
            <h3><i class="fas fa-dna"></i> 4ë‹¨ê³„: ì—¼ê¸° ì¡°ì„± ë° GC í•¨ëŸ‰ ë¶„ì„</h3>
            
            <div class="code-block-container">
                <div class="code-block python">
def analyze_sequence_composition(sequences, gc_contents):
    """ì„œì—´ ì¡°ì„±ì„ ë¶„ì„í•˜ê³  ì‹œê°í™”í•©ë‹ˆë‹¤."""
    
    print("ğŸ§¬ ì„œì—´ ì¡°ì„± ë¶„ì„ ì¤‘...")
    
    # ì—¼ê¸° ì¡°ì„± ê³„ì‚°
    base_counts = Counter()
    total_bases = 0
    
    for seq in sequences:
        for base in seq:
            base_counts[base] += 1
            total_bases += 1
    
    # ìœ„ì¹˜ë³„ ì—¼ê¸° ì¡°ì„± (ì²˜ìŒ 50bpë§Œ)
    position_bases = defaultdict(lambda: defaultdict(int))
    max_pos = min(50, min(len(seq) for seq in sequences))
    
    for seq in sequences:
        for pos in range(max_pos):
            base = seq[pos]
            position_bases[pos][base] += 1
    
    # ì‹œê°í™”
    fig, axes = plt.subplots(2, 2, figsize=(15, 10))
    
    # 1. ì „ì²´ ì—¼ê¸° ì¡°ì„±
    bases = ['A', 'T', 'G', 'C', 'N']
    counts = [base_counts[base] for base in bases]
    percentages = [count / total_bases * 100 for count in counts]
    
    colors = ['red', 'blue', 'green', 'orange', 'gray']
    axes[0, 0].bar(bases, percentages, color=colors, alpha=0.7)
    axes[0, 0].set_ylabel('ë¹„ìœ¨ (%)')
    axes[0, 0].set_title('ì „ì²´ ì—¼ê¸° ì¡°ì„±')
    axes[0, 0].grid(True, alpha=0.3)
    
    # ê° ë§‰ëŒ€ì— ë°±ë¶„ìœ¨ í‘œì‹œ
    for i, (base, pct) in enumerate(zip(bases, percentages)):
        axes[0, 0].text(i, pct + 0.1, f'{pct:.1f}%', ha='center', va='bottom')
    
    # 2. GC í•¨ëŸ‰ ë¶„í¬
    axes[0, 1].hist(gc_contents, bins=30, alpha=0.7, color='lightcoral', edgecolor='black')
    axes[0, 1].axvline(x=np.mean(gc_contents), color='red', linestyle='--', 
                      label=f'í‰ê· : {np.mean(gc_contents):.1f}%')
    axes[0, 1].set_xlabel('GC í•¨ëŸ‰ (%)')
    axes[0, 1].set_ylabel('ë¦¬ë“œ ìˆ˜')
    axes[0, 1].set_title('GC í•¨ëŸ‰ ë¶„í¬')
    axes[0, 1].legend()
    axes[0, 1].grid(True, alpha=0.3)
    
    # 3. ìœ„ì¹˜ë³„ ì—¼ê¸° ì¡°ì„± (ì²˜ìŒ 50bp)
    positions = list(range(1, max_pos + 1))
    base_percentages = {base: [] for base in bases}
    
    for pos in range(max_pos):
        total_at_pos = sum(position_bases[pos].values())
        for base in bases:
            pct = position_bases[pos][base] / total_at_pos * 100 if total_at_pos > 0 else 0
            base_percentages[base].append(pct)
    
    for base, color in zip(bases, colors):
        axes[1, 0].plot(positions, base_percentages[base], 
                       color=color, linewidth=2, label=base, marker='o', markersize=3)
    
    axes[1, 0].set_xlabel('ì—¼ê¸° ìœ„ì¹˜')
    axes[1, 0].set_ylabel('ë¹„ìœ¨ (%)')
    axes[1, 0].set_title('ìœ„ì¹˜ë³„ ì—¼ê¸° ì¡°ì„± (ì²˜ìŒ 50bp)')
    axes[1, 0].legend()
    axes[1, 0].grid(True, alpha=0.3)
    
    # 4. ë¦¬ë“œ ê¸¸ì´ ë¶„í¬
    lengths = [len(seq) for seq in sequences]
    axes[1, 1].hist(lengths, bins=30, alpha=0.7, color='lightblue', edgecolor='black')
    axes[1, 1].axvline(x=np.mean(lengths), color='red', linestyle='--', 
                      label=f'í‰ê· : {np.mean(lengths):.1f}bp')
    axes[1, 1].set_xlabel('ë¦¬ë“œ ê¸¸ì´ (bp)')
    axes[1, 1].set_ylabel('ë¦¬ë“œ ìˆ˜')
    axes[1, 1].set_title('ë¦¬ë“œ ê¸¸ì´ ë¶„í¬')
    axes[1, 1].legend()
    axes[1, 1].grid(True, alpha=0.3)
    
    plt.tight_layout()
    plt.show()
    
    # í†µê³„ ìš”ì•½
    print(f"\nğŸ§¬ ì„œì—´ ì¡°ì„± í†µê³„:")
    print(f"   A: {percentages[0]:.1f}%")
    print(f"   T: {percentages[1]:.1f}%")
    print(f"   G: {percentages[2]:.1f}%")
    print(f"   C: {percentages[3]:.1f}%")
    print(f"   N: {percentages[4]:.1f}%")
    print(f"   í‰ê·  GC í•¨ëŸ‰: {np.mean(gc_contents):.1f}%")
    print(f"   í‰ê·  ë¦¬ë“œ ê¸¸ì´: {np.mean(lengths):.1f}bp")
    
    return {
        'base_counts': base_counts,
        'gc_contents': gc_contents,
        'lengths': lengths
    }

# ì„œì—´ ì¡°ì„± ë¶„ì„ ì‹¤í–‰
composition_analysis = analyze_sequence_composition(sample_data['sequences'], sample_data['gc_contents'])
</div>
            </div>
        </div>

        <h2>ğŸ”¬ ì‹¬í™” ë¶„ì„</h2>
        <div class="exercise-box">
            <h3><i class="fas fa-flask"></i> ì¶”ê°€ ì‹¤ìŠµ ê³¼ì œ</h3>
            <ol>
                <li><strong>Paired-End ë¶„ì„:</strong> R1ê³¼ R2 íŒŒì¼ì„ ë¹„êµí•˜ì—¬ í’ˆì§ˆ ì°¨ì´ë¥¼ ë¶„ì„í•´ë³´ì„¸ìš”.</li>
                <li><strong>ì–´ëŒ‘í„° ê²€ì¶œ:</strong> ë¦¬ë“œì—ì„œ ì–´ëŒ‘í„° ì„œì—´ì´ í¬í•¨ëœ ë¹„ìœ¨ì„ ê³„ì‚°í•´ë³´ì„¸ìš”.</li>
                <li><strong>í’ˆì§ˆ í•„í„°ë§:</strong> Q20 ì´ìƒì¸ ë¦¬ë“œë§Œ ì„ ë³„í•˜ì—¬ ë¶„ì„í•´ë³´ì„¸ìš”.</li>
                <li><strong>ë³µì¡ë„ ë¶„ì„:</strong> ì„œì—´ì˜ ë³µì¡ë„(ì¤‘ë³µ k-mer ë¹„ìœ¨)ë¥¼ ê³„ì‚°í•´ë³´ì„¸ìš”.</li>
            </ol>
        </div>

        <div class="result-box">
            <h3><i class="fas fa-check-circle"></i> ì‹¤ìŠµ ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
            <ul>
                <li>âœ… FASTQ íŒŒì¼ êµ¬ì¡° ì´í•´</li>
                <li>âœ… Pythonìœ¼ë¡œ FASTQ íŒŒì¼ íŒŒì‹±</li>
                <li>âœ… í’ˆì§ˆ ì ìˆ˜ ë¶„ì„ ë° ì‹œê°í™”</li>
                <li>âœ… ì„œì—´ ì¡°ì„± ë¶„ì„</li>
                <li>âœ… GC í•¨ëŸ‰ ë¶„í¬ í™•ì¸</li>
                <li>âœ… ë¦¬ë“œ ê¸¸ì´ ë¶„í¬ ë¶„ì„</li>
            </ul>
        </div>

        <h2>ğŸ¯ ë‹¤ìŒ ë‹¨ê³„</h2>
        <p>ì´ì œ ë°ì´í„°ì˜ í’ˆì§ˆì„ íŒŒì•…í–ˆìœ¼ë‹ˆ, ë‹¤ìŒ ì‹¤ìŠµì—ì„œëŠ” FastQCì™€ Trimmomaticì„ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ í’ˆì§ˆ ê´€ë¦¬ ë° ì „ì²˜ë¦¬ë¥¼ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.</p>

    </div>
</div>

<div class="navigation">
    <button class="jump-btn" onclick="jumpToIndex()">ğŸ  ëª©ì°¨</button>
    <button class="nav-btn" onclick="prevSlide()">â—€ ì´ì „</button>
    <button class="nav-btn" onclick="nextSlide()">ë‹¤ìŒ â–¶</button>
    <button class="fullscreen-btn" onclick="toggleFullscreen()">â›¶ ì „ì²´í™”ë©´</button>
</div>

<div class="slide-number">ìŠ¬ë¼ì´ë“œ 4 / 8</div>

<script>
    // Syntax highlighting function
    function highlightCode() {
        const codeBlocks = document.querySelectorAll('.code-block');
        
        codeBlocks.forEach(block => {
            const code = block.textContent;
            const language = block.classList.contains('python') ? 'python' : 
                           block.classList.contains('bash') ? 'bash' : 'python'; // default to python
            
            const highlightedCode = highlightSyntax(code, language);
            block.innerHTML = highlightedCode;
            
            // Add copy button
            addCopyButton(block, code);
        });
    }
    
    // Add copy button to code block
    function addCopyButton(codeBlock, originalCode) {
        // Check if copy button already exists
        const container = codeBlock.parentElement;
        if (container && container.querySelector('.copy-button')) {
            return; // Copy button already exists
        }
        
        const copyButton = document.createElement('button');
        copyButton.className = 'copy-button';
        copyButton.textContent = 'Copy';
        copyButton.title = 'Copy code to clipboard';
        
        copyButton.addEventListener('click', function() {
            copyToClipboard(originalCode, copyButton);
        });
        
        // Append to container if it exists, otherwise to code block
        if (container && container.classList.contains('code-block-container')) {
            container.appendChild(copyButton);
        } else {
            codeBlock.style.position = 'relative'; // Ensure positioning context
            codeBlock.appendChild(copyButton);
        }
    }
    
    // Copy text to clipboard
    function copyToClipboard(text, button) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            // Modern approach
            navigator.clipboard.writeText(text).then(function() {
                showCopySuccess(button);
            }).catch(function() {
                fallbackCopyToClipboard(text, button);
            });
        } else {
            // Fallback for older browsers
            fallbackCopyToClipboard(text, button);
        }
    }
    
    // Fallback copy method
    function fallbackCopyToClipboard(text, button) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        textArea.style.top = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            document.execCommand('copy');
            showCopySuccess(button);
        } catch (err) {
            console.error('Copy failed:', err);
        }
        
        document.body.removeChild(textArea);
    }
    
    // Show copy success feedback
    function showCopySuccess(button) {
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        button.classList.add('copied');
        
        setTimeout(function() {
            button.textContent = originalText;
            button.classList.remove('copied');
        }, 2000);
    }
    
    function highlightSyntax(code, language) {
        if (language === 'python') {
            return highlightPython(code);
        } else if (language === 'bash') {
            return highlightBash(code);
        }
        return code;
    }
    
    function highlightPython(code) {
        let highlighted = code;
        
        // 1. Highlight strings first
        highlighted = highlighted.replace(/"[^"]*"/g, '<span class="string">$&</span>');
        highlighted = highlighted.replace(/'[^']*'/g, '<span class="string">$&</span>');
        
        // 2. Highlight comments
        highlighted = highlighted.replace(/#.*$/gm, '<span class="comment">$&</span>');
        
        // 3. Highlight keywords
        const keywords = ['import', 'from', 'def', 'if', 'else', 'elif', 'for', 'while', 'try', 'except', 'with', 'as', 'return', 'and', 'or', 'not', 'in', 'is', 'True', 'False', 'None'];
        keywords.forEach(keyword => {
            const regex = new RegExp(`\\b${keyword}\\b`, 'g');
            highlighted = highlighted.replace(regex, `<span class="keyword">${keyword}</span>`);
        });
        
        // 4. Highlight built-in functions
        const builtins = ['print', 'len', 'open', 'range', 'enumerate', 'gzip', 'os', 'plt', 'np', 'Counter', 'Path', 'subprocess', 'str', 'int', 'float', 'list', 'dict', 'set', 'tuple', 'zip', 'sorted', 'sum', 'max', 'min', 'time'];
        builtins.forEach(builtin => {
            const regex = new RegExp(`\\b${builtin}\\b`, 'g');
            highlighted = highlighted.replace(regex, `<span class="builtin">${builtin}</span>`);
        });
        
        // 5. Highlight function definitions
        highlighted = highlighted.replace(/\b(def\s+)(\w+)/g, '$1<span class="function">$2</span>');
        
        // 6. Highlight numbers
        highlighted = highlighted.replace(/\b\d+\b/g, '<span class="number">$&</span>');
        
        return highlighted;
    }
    
    function highlightBash(code) {
        const keywords = ['if', 'then', 'else', 'elif', 'fi', 'for', 'while', 'do', 'done', 'case', 'esac', 'function', 'return', 'local', 'export', 'echo', 'cd', 'ls', 'mkdir', 'cp', 'mv', 'rm', 'chmod', 'chown', 'grep', 'sed', 'awk', 'sort', 'uniq', 'wc', 'cat', 'head', 'tail', 'conda', 'wget', 'unzip', 'fastqc', 'trimmomatic', 'du', 'file'];
        
        // Split into lines to process line by line (avoids conflicts)
        const lines = code.split('\n');
        const highlightedLines = [];
        
        for (let line of lines) {
            let highlighted = line;
            
            // Skip if line is empty
            if (!highlighted.trim()) {
                highlightedLines.push(highlighted);
                continue;
            }
            
            // 1. Highlight shebang
            if (highlighted.match(/^#!/)) {
                highlighted = highlighted.replace(/^(#!.*)$/, '<span class="shebang">$1</span>');
                highlightedLines.push(highlighted);
                continue;
            }
            
            // 2. Highlight full-line comments
            if (highlighted.trim().startsWith('#')) {
                highlighted = highlighted.replace(/^(\s*)(#.*)$/, '$1<span class="comment">$2</span>');
                highlightedLines.push(highlighted);
                continue;
            }
            
            // 3. Highlight strings
            highlighted = highlighted.replace(/("[^"]*")/g, '<span class="string">$1</span>');
            highlighted = highlighted.replace(/('[^']*')/g, '<span class="string">$1</span>');
            
            // 4. Highlight inline comments (after code)
            highlighted = highlighted.replace(/(\s+)(#.*)$/, '$1<span class="comment">$2</span>');
            
            // 5. Highlight variables
            highlighted = highlighted.replace(/(\$\w+)/g, '<span class="variable">$1</span>');
            
            // 6. Highlight keywords
            keywords.forEach(keyword => {
                const regex = new RegExp(`\\b${keyword}\\b`, 'g');
                highlighted = highlighted.replace(regex, `<span class="keyword">${keyword}</span>`);
            });
            
            highlightedLines.push(highlighted);
        }
        
        return highlightedLines.join('\n');
    }
    
    // Apply syntax highlighting on page load
    document.addEventListener('DOMContentLoaded', function() {
        highlightCode();
    });
    
    // Navigation functions
    function prevSlide() {
        window.location.href = "slide03.html";
    }
    
    function nextSlide() {
        window.location.href = "slide05.html";
    }
    
    function jumpToIndex() {
        window.location.href = "index.html";
    }
    
    function toggleFullscreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }
    }
    
    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowRight' || e.key === ' ') {
            nextSlide();
        } else if (e.key === 'ArrowLeft') {
            prevSlide();
        } else if (e.key === 'Home') {
            jumpToIndex();
        } else if (e.key === 'F11') {
            e.preventDefault();
            toggleFullscreen();
        }
    });
</script>

</body>
</html>