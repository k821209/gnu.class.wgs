<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ìŠµ 4: ë³€ì´ í˜¸ì¶œ - GATK HaplotypeCallerë¥¼ ì´ìš©í•œ ë³€ì´ ê²€ì¶œ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body { font-family: 'Malgun Gothic', Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
        .slide { width: 100%; height: 100vh; display: block; padding: 40px; box-sizing: border-box; background: white; }
        .slide-title { font-size: 36px; font-weight: bold; color: #2c3e50; margin-bottom: 30px; border-bottom: 3px solid #9b59b6; padding-bottom: 10px; }
        .slide-content { font-size: 18px; line-height: 1.6; color: #34495e; }
        .slide-content h2 { color: #9b59b6; font-size: 24px; margin-top: 30px; }
        .slide-content h3 { color: #e74c3c; font-size: 20px; margin-top: 20px; }
        .slide-content ul { margin: 15px 0; padding-left: 30px; }
        .slide-content li { margin: 8px 0; }
        .highlight { background: #fff3cd; padding: 3px 8px; border-radius: 3px; }
        .code-block { background: #1e1e1e; color: #f8f8f2; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; margin: 15px 0; font-size: 14px; white-space: pre-wrap; border: 1px solid #444; position: relative; }
        .code-block-container { position: relative; }
        .copy-button { position: absolute; top: 10px; right: 10px; background: #444; color: #f8f8f2; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px; opacity: 0.7; transition: opacity 0.2s; }
        .copy-button:hover { opacity: 1; background: #555; }
        .copy-button.copied { background: #27ae60; color: white; }
        .copy-button.copied:after { content: " âœ“"; }
        
        /* Syntax highlighting color classes */
        .comment { color: #75715e; } /* Comments */
        .keyword { color: #f92672; } /* Keywords */
        .function { color: #a6e22e; } /* Function names */
        .string { color: #e6db74; } /* Strings */
        .number { color: #ae81ff; } /* Numbers */
        .param { color: #fd971f; } /* Parameters */
        .variable { color: #f8f8f2; } /* Variables */
        .builtin { color: #a6e22e; } /* Built-in functions */
        .operator { color: #f92672; } /* Operators */
        .shebang { color: #75715e; } /* Shebang */
        .navigation { position: fixed; bottom: 20px; right: 20px; z-index: 1000; }
        .nav-btn { background: #9b59b6; color: white; border: none; padding: 10px 20px; margin: 0 5px; border-radius: 5px; cursor: pointer; }
        .nav-btn:hover { background: #8e44ad; }
        .fullscreen-btn { background: #e74c3c; color: white; border: none; padding: 10px 15px; margin: 0 5px; border-radius: 5px; cursor: pointer; }
        .fullscreen-btn:hover { background: #c0392b; }
        .jump-btn { background: #3498db; color: white; border: none; padding: 10px 15px; margin: 0 5px; border-radius: 5px; cursor: pointer; }
        .jump-btn:hover { background: #2980b9; }
        .slide-number { position: fixed; bottom: 20px; left: 20px; color: #7f8c8d; font-size: 14px; }
        .comparison-table { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .comparison-item { background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #9b59b6; }
        .comparison-item h4 { margin: 0 0 10px 0; color: #2c3e50; }
        .setup-steps { background: #e8f4fd; border-left: 4px solid #3498db; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .practical-box { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin: 20px 0; }
        .exercise-box { background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .result-box { background: #d4edda; border-left: 4px solid #28a745; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .warning-box { background: #f8d7da; border-left: 4px solid #dc3545; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .step-box { background: #ffffff; border: 2px solid #9b59b6; border-radius: 8px; padding: 15px; margin: 10px 0; position: relative; }
        .step-box::before { content: "â†’"; position: absolute; right: -15px; top: 50%; transform: translateY(-50%); font-size: 24px; color: #9b59b6; }
        .step-box:last-child::before { display: none; }
        .terminal-output { background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; margin: 15px 0; font-size: 13px; white-space: pre-wrap; }
        .gatk-flow { background: #ffffff; border: 2px solid #e67e22; border-radius: 8px; padding: 15px; margin: 15px 0; }
        .variant-types { background: #f3e5f5; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .performance-tip { background: #f0f8ff; border-left: 4px solid #007bff; padding: 15px; margin: 15px 0; border-radius: 8px; }
        .vcf-example { background: #1e1e1e; color: #f8f8f2; padding: 12px; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 11px; margin: 15px 0; }
        .statistics-box { background: #e8f5e8; border-left: 4px solid #28a745; padding: 15px; margin: 15px 0; border-radius: 8px; }
    </style>
</head>
<body>

<div class="slide">
    <div class="slide-title">ğŸ§¬ ì‹¤ìŠµ 4: ë³€ì´ í˜¸ì¶œ</div>
    <div class="slide-content">
        <h2>ğŸ¯ ì‹¤ìŠµ ëª©í‘œ</h2>
        <p>ì •ë ¬ëœ BAM íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ GATK HaplotypeCallerë¡œ ë³€ì´ë¥¼ í˜¸ì¶œí•˜ê³ , VCF íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ë³€ì´ë¥¼ ë¶„ì„í•˜ëŠ” ì‹¤ìŠµì„ ì§„í–‰í•©ë‹ˆë‹¤.</p>

        <div class="comparison-table">
            <div class="comparison-item">
                <h4><i class="fas fa-bullseye"></i> í•™ìŠµ ëª©í‘œ</h4>
                <ul>
                    <li>GATK HaplotypeCaller ì‚¬ìš©ë²•</li>
                    <li>gVCFì™€ VCF íŒŒì¼ ìƒì„±</li>
                    <li>ë³€ì´ í˜¸ì¶œ íŒŒë¼ë¯¸í„° ì´í•´</li>
                    <li>VCF íŒŒì¼ êµ¬ì¡° ë¶„ì„</li>
                    <li>ë³€ì´ í†µê³„ ë° í’ˆì§ˆ í‰ê°€</li>
                </ul>
            </div>
            
            <div class="comparison-item" style="border-left-color: #e74c3c;">
                <h4><i class="fas fa-tools"></i> ì‚¬ìš© ë„êµ¬</h4>
                <ul>
                    <li><strong>GATK HaplotypeCaller:</strong> ë³€ì´ í˜¸ì¶œ ì•Œê³ ë¦¬ì¦˜</li>
                    <li><strong>bcftools:</strong> VCF íŒŒì¼ ì²˜ë¦¬ ë° ë¶„ì„</li>
                    <li><strong>SnpEff:</strong> ë³€ì´ ì£¼ì„ ë° ê¸°ëŠ¥ ì˜ˆì¸¡</li>
                    <li><strong>Python:</strong> ë³€ì´ í†µê³„ ë¶„ì„ ë° ì‹œê°í™”</li>
                </ul>
            </div>
        </div>

        <h2>ğŸ“‹ ì‹¤ìŠµ ì›Œí¬í”Œë¡œìš°</h2>
        <div class="practical-box">
            <div class="step-box">
                <h4><i class="fas fa-cog"></i> 1ë‹¨ê³„: GATK í™˜ê²½ ì„¤ì •</h4>
                <p>GATK ì„¤ì¹˜ í™•ì¸ ë° ì°¸ì¡° ê²Œë†ˆ ì¤€ë¹„</p>
            </div>

            <div class="step-box">
                <h4><i class="fas fa-dna"></i> 2ë‹¨ê³„: HaplotypeCaller ì‹¤í–‰</h4>
                <p>BAM íŒŒì¼ì—ì„œ gVCF í˜•íƒœë¡œ ë³€ì´ í˜¸ì¶œ</p>
            </div>

            <div class="step-box">
                <h4><i class="fas fa-filter"></i> 3ë‹¨ê³„: GenotypeGVCFs ì‹¤í–‰</h4>
                <p>gVCFë¥¼ ìµœì¢… VCFë¡œ ë³€í™˜</p>
            </div>

            <div class="step-box">
                <h4><i class="fas fa-chart-bar"></i> 4ë‹¨ê³„: ë³€ì´ í†µê³„ ë¶„ì„</h4>
                <p>í˜¸ì¶œëœ ë³€ì´ì˜ ìœ í˜•ë³„ í†µê³„ ë° í’ˆì§ˆ í‰ê°€</p>
            </div>

            <div class="step-box">
                <h4><i class="fas fa-tags"></i> 5ë‹¨ê³„: ë³€ì´ ì£¼ì„</h4>
                <p>SnpEffë¥¼ ì´ìš©í•œ ë³€ì´ ê¸°ëŠ¥ ì˜ˆì¸¡</p>
            </div>
        </div>

        <h2>âš™ï¸ 1ë‹¨ê³„: GATK í™˜ê²½ ì„¤ì •</h2>
        <div class="setup-steps">
            <h3><i class="fas fa-check-circle"></i> GATK ì„¤ì¹˜ í™•ì¸</h3>
            <p>GATKì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ë²„ì „ì„ ì²´í¬í•©ë‹ˆë‹¤.</p>
            
            <div class="code-block-container">
                <div class="code-block bash">
# GATK ë²„ì „ í™•ì¸
gatk --version

# ë˜ëŠ” Java ê¸°ë°˜ ì‹¤í–‰
java -jar /opt/gatk/gatk-package-4.3.0.0-local.jar --version

# ë„ì›€ë§ í™•ì¸
gatk --help
</div>
            </div>
        </div>

        <div class="setup-steps">
            <h3><i class="fas fa-database"></i> ì°¸ì¡° ê²Œë†ˆ ì¸ë±ìŠ¤ ì¤€ë¹„</h3>
            <p>GATKì—ì„œ ì‚¬ìš©í•  ì°¸ì¡° ê²Œë†ˆ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
            
            <div class="code-block-container">
                <div class="code-block bash">
# ì‘ì—… ë””ë ‰í† ë¦¬ ì´ë™
cd /home/ubuntu/edu/reference

# FASTA ì¸ë±ìŠ¤ ìƒì„± (ì´ë¯¸ ìˆìœ¼ë©´ ìƒëµ)
samtools faidx soybean_genome.fa

# GATK ë”•ì…”ë„ˆë¦¬ ìƒì„±
gatk CreateSequenceDictionary \
    -R soybean_genome.fa \
    -O soybean_genome.dict

# ìƒì„±ëœ íŒŒì¼ í™•ì¸
ls -la soybean_genome.fa.*
ls -la soybean_genome.dict
</div>
            </div>
            
            <div class="terminal-output">
soybean_genome.fa
soybean_genome.fa.fai
soybean_genome.dict
</div>
        </div>

        <h2>ğŸ§¬ 2ë‹¨ê³„: HaplotypeCaller ì‹¤í–‰</h2>
        <div class="practical-box">
            <h3><i class="fas fa-play"></i> gVCF ëª¨ë“œë¡œ ë³€ì´ í˜¸ì¶œ</h3>
            <p>ê°œë³„ ìƒ˜í”Œì˜ gVCFë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ëŠ” ë‚˜ì¤‘ì— ë‹¤ì¤‘ ìƒ˜í”Œ ë¶„ì„ì— ìœ ìš©í•©ë‹ˆë‹¤.</p>
            
            <div class="code-block-container">
                <div class="code-block bash">
# ê²°ê³¼ ë””ë ‰í† ë¦¬ ìƒì„±
cd /home/ubuntu/edu/
mkdir -p variant_calling

# GATK HaplotypeCaller ì‹¤í–‰ (gVCF ëª¨ë“œ)
gatk HaplotypeCaller \
    -R /home/ubuntu/edu/reference/soybean_genome.fa \
    -I alignment_results/soybean_sorted.bam \
    -O variant_calling/soybean_raw.g.vcf.gz \
    -ERC GVCF \
    --native-pair-hmm-threads 4

# ì§„í–‰ ìƒí™© í™•ì¸
ls -lh variant_calling/
</div>
            </div>
        </div>

        <div class="gatk-flow">
            <h4><i class="fas fa-info-circle"></i> GATK HaplotypeCaller ì£¼ìš” ì˜µì…˜</h4>
            <div class="comparison-table">
                <div class="comparison-item" style="border-left-color: #28a745;">
                    <h4>í•„ìˆ˜ ë§¤ê°œë³€ìˆ˜</h4>
                    <ul>
                        <li><strong>-R:</strong> ì°¸ì¡° ê²Œë†ˆ FASTA íŒŒì¼</li>
                        <li><strong>-I:</strong> ì…ë ¥ BAM íŒŒì¼</li>
                        <li><strong>-O:</strong> ì¶œë ¥ VCF/gVCF íŒŒì¼</li>
                        <li><strong>-ERC GVCF:</strong> gVCF ëª¨ë“œ í™œì„±í™”</li>
                    </ul>
                </div>
                
                <div class="comparison-item" style="border-left-color: #f39c12;">
                    <h4>ì„±ëŠ¥ ì˜µì…˜</h4>
                    <ul>
                        <li><strong>--native-pair-hmm-threads:</strong> ìŠ¤ë ˆë“œ ìˆ˜</li>
                        <li><strong>ìƒ˜í”Œ ì´ë¦„:</strong> BAM íŒŒì¼ì˜ Read Groupì—ì„œ ìë™ ì¶”ì¶œ</li>
                        <li><strong>-L:</strong> íŠ¹ì • ì˜ì—­ë§Œ ë¶„ì„</li>
                        <li><strong>--tmp-dir:</strong> ì„ì‹œ ë””ë ‰í† ë¦¬ ì§€ì •</li>
                    </ul>
                </div>
            </div>
        </div>

        <h2>ğŸ”„ 3ë‹¨ê³„: GenotypeGVCFs ì‹¤í–‰</h2>
        <div class="practical-box">
            <h3><i class="fas fa-exchange-alt"></i> gVCFë¥¼ ìµœì¢… VCFë¡œ ë³€í™˜</h3>
            <p>gVCF íŒŒì¼ì„ ìµœì¢… ë¶„ì„ ê°€ëŠ¥í•œ VCF íŒŒì¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>
            
            <div class="code-block-container">
                <div class="code-block bash">
# GenotypeGVCFs ì‹¤í–‰
gatk GenotypeGVCFs \
    -R /home/ubuntu/edu/reference/soybean_genome.fa \
    -V variant_calling/soybean_raw.g.vcf.gz \
    -O variant_calling/soybean_gatk.vcf.gz

# VCF ì¸ë±ìŠ¤ ìƒì„±
gatk IndexFeatureFile \
    -I variant_calling/soybean_gatk.vcf.gz

# íŒŒì¼ í¬ê¸° í™•ì¸
ls -lh variant_calling/*.vcf*
</div>
            </div>
        </div>

        <h2>ğŸ› ï¸ ëŒ€ì•ˆ: bcftoolsë¥¼ ì´ìš©í•œ ë³€ì´ í˜¸ì¶œ</h2>
        <div class="practical-box">
            <h3><i class="fas fa-tools"></i> bcftools mpileup + call íŒŒì´í”„ë¼ì¸</h3>
            <p>GATK ëŒ€ì‹  bcftoolsë¥¼ ì‚¬ìš©í•œ ë³€ì´ í˜¸ì¶œ ë°©ë²•ì…ë‹ˆë‹¤. ë” ë¹ ë¥´ê³  ë©”ëª¨ë¦¬ íš¨ìœ¨ì ì…ë‹ˆë‹¤.</p>
            
            <div class="code-block-container">
                <div class="code-block bash">
# bcftools mpileupìœ¼ë¡œ ë³€ì´ í˜¸ì¶œ
bcftools mpileup \
    -f /home/ubuntu/edu/reference/soybean_genome.fa \
    -q 20 \
    -Q 20 \
    -a FORMAT/DP,FORMAT/AD \
    alignment_results/soybean_sorted.bam | \
bcftools call \
    -mv \
    -Oz \
    -o variant_calling/soybean_bcftools.vcf.gz

# VCF ì¸ë±ìŠ¤ ìƒì„±
bcftools index variant_calling/soybean_bcftools.vcf.gz

# ë³€ì´ ì •ê·œí™” (ì„ íƒì‚¬í•­)
bcftools norm \
    -f /home/ubuntu/edu/reference/soybean_genome.fa \
    -m -any \
    variant_calling/soybean_bcftools.vcf.gz \
    -Oz -o variant_calling/soybean_bcftools_norm.vcf.gz

bcftools index variant_calling/soybean_bcftools_norm.vcf.gz
</div>
            </div>
        </div>

        <div class="gatk-flow">
            <h4><i class="fas fa-balance-scale"></i> GATK vs bcftools ë¹„êµ</h4>
            <div class="comparison-table">
                <div class="comparison-item" style="border-left-color: #9b59b6;">
                    <h4><i class="fas fa-dna"></i> GATK HaplotypeCaller</h4>
                    <ul>
                        <li><strong>ì¥ì :</strong> ë†’ì€ ì •í™•ë„, gVCF ì§€ì›</li>
                        <li><strong>ë‹¨ì :</strong> ë†’ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰, ëŠë¦¼</li>
                        <li><strong>ì í•©:</strong> ê³ í’ˆì§ˆ ë¶„ì„, ë‹¤ì¤‘ ìƒ˜í”Œ</li>
                        <li><strong>íŠ¹ì§•:</strong> ë¡œì»¬ ì–´ì…ˆë¸”ë¦¬ ê¸°ë°˜</li>
                    </ul>
                </div>
                
                <div class="comparison-item" style="border-left-color: #3498db;">
                    <h4><i class="fas fa-tools"></i> bcftools mpileup</h4>
                    <ul>
                        <li><strong>ì¥ì :</strong> ë¹ ë¥¸ ì†ë„, ë‚®ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©</li>
                        <li><strong>ë‹¨ì :</strong> ìƒëŒ€ì ìœ¼ë¡œ ë‚®ì€ ì •í™•ë„</li>
                        <li><strong>ì í•©:</strong> ë¹ ë¥¸ ìŠ¤í¬ë¦¬ë‹, ëŒ€ìš©ëŸ‰ ë°ì´í„°</li>
                        <li><strong>íŠ¹ì§•:</strong> í†µê³„ì  ëª¨ë¸ ê¸°ë°˜</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="exercise-box">
            <h3><i class="fas fa-microscope"></i> bcftools ìƒì„¸ ë§¤ê°œë³€ìˆ˜</h3>
            
            <div class="comparison-table">
                <div class="comparison-item" style="border-left-color: #28a745;">
                    <h4>mpileup ì˜µì…˜</h4>
                    <ul>
                        <li><strong>-f:</strong> ì°¸ì¡° ê²Œë†ˆ FASTA íŒŒì¼</li>
                        <li><strong>-q:</strong> ìµœì†Œ ë§¤í•‘ í’ˆì§ˆ (ê¸°ë³¸ê°’: 0)</li>
                        <li><strong>-Q:</strong> ìµœì†Œ ì—¼ê¸° í’ˆì§ˆ (ê¸°ë³¸ê°’: 13)</li>
                        <li><strong>-a:</strong> ì¶”ê°€ ì£¼ì„ ì •ë³´</li>
                        <li><strong>-d:</strong> ìµœëŒ€ ê¹Šì´ (ê¸°ë³¸ê°’: 250)</li>
                    </ul>
                </div>
                
                <div class="comparison-item" style="border-left-color: #f39c12;">
                    <h4>call ì˜µì…˜</h4>
                    <ul>
                        <li><strong>-m:</strong> ë‹¤ì¤‘ ëŒ€ë¦½ìœ ì „ì ëª¨ë¸</li>
                        <li><strong>-v:</strong> ë³€ì´ë§Œ ì¶œë ¥</li>
                        <li><strong>-Oz:</strong> gzip ì••ì¶• ì¶œë ¥</li>
                        <li><strong>-o:</strong> ì¶œë ¥ íŒŒì¼ëª…</li>
                        <li><strong>-c:</strong> ì»¨ì„¼ì„œìŠ¤ ëª¨ë¸ (ëŒ€ì•ˆ)</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="exercise-box">
            <h3><i class="fas fa-eye"></i> VCF íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° ë° ë¹„êµ</h3>
            
            <div class="code-block-container">
                <div class="code-block bash">
# GATK ê²°ê³¼ í™•ì¸
echo "=== GATK ê²°ê³¼ ==="
bcftools view -h variant_calling/soybean_gatk.vcf.gz | head -20
bcftools view -H variant_calling/soybean_gatk.vcf.gz | head -5

echo "=== bcftools ê²°ê³¼ ==="
bcftools view -h variant_calling/soybean_bcftools.vcf.gz | head -20
bcftools view -H variant_calling/soybean_bcftools.vcf.gz | head -5

# ë³€ì´ ê°œìˆ˜ ë¹„êµ
echo "=== ë³€ì´ ê°œìˆ˜ ë¹„êµ ==="
echo "GATK ë³€ì´ ìˆ˜:"
bcftools stats variant_calling/soybean_gatk.vcf.gz | grep "^SN"

echo "bcftools ë³€ì´ ìˆ˜:"
bcftools stats variant_calling/soybean_bcftools.vcf.gz | grep "^SN"
</div>
            </div>
        </div>

        <h2>ğŸ“Š 4ë‹¨ê³„: ë³€ì´ í†µê³„ ë¶„ì„</h2>
        <div class="practical-box">
            <h3><i class="fas fa-chart-line"></i> Pythonì„ ì´ìš©í•œ ë³€ì´ ë¶„ì„</h3>
            
            <div class="code-block-container">
                <div class="code-block python">
# !pip install koreanize-matplotlib í„°ë¯¸ë„ì— ì…ë ¥í•˜ì—¬ ì„¤ì¹˜
# ì„¤ì¹˜ í›„ importë¡œ ë¶ˆëŸ¬ì˜¤ê¸°

import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import subprocess
import numpy as np
from collections import Counter
import gzip
import koreanize_matplotlib

def analyze_vcf_statistics(vcf_file):
    """VCF íŒŒì¼ì˜ ë³€ì´ í†µê³„ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤."""
    
    # bcftools stats ì‹¤í–‰
    result = subprocess.run(['bcftools', 'stats', vcf_file], 
                          capture_output=True, text=True)
    
    stats = {}
    lines = result.stdout.strip().split('\n')
    
    for line in lines:
        if line.startswith('SN'):
            parts = line.split('\t')
            if len(parts) >= 4:
                key = parts[2].strip(':')
                value = parts[3]
                stats[key] = value
    
    return stats

def parse_vcf_variants(vcf_file):
    """VCF íŒŒì¼ì—ì„œ ë³€ì´ ì •ë³´ë¥¼ íŒŒì‹±í•©ë‹ˆë‹¤."""
    
    variants = []
    
    # gzip íŒŒì¼ì¸ì§€ í™•ì¸
    if vcf_file.endswith('.gz'):
        file_opener = gzip.open
        mode = 'rt'
    else:
        file_opener = open
        mode = 'r'
    
    with file_opener(vcf_file, mode) as f:
        for line in f:
            if line.startswith('#'):
                continue
                
            fields = line.strip().split('\t')
            if len(fields) < 8:
                continue
                
            chrom = fields[0]
            pos = int(fields[1])
            ref = fields[3]
            alt = fields[4]
            qual = float(fields[5]) if fields[5] != '.' else 0
            info = fields[7]
            
            # ë³€ì´ ìœ í˜• ê²°ì •
            if len(ref) == 1 and len(alt) == 1:
                variant_type = 'SNP'
            elif len(ref) > len(alt):
                variant_type = 'Deletion'
            elif len(ref) < len(alt):
                variant_type = 'Insertion'
            else:
                variant_type = 'Complex'
            
            # DP ì •ë³´ ì¶”ì¶œ
            dp = 0
            for info_field in info.split(';'):
                if info_field.startswith('DP='):
                    dp = int(info_field.split('=')[1])
                    break
            
            variants.append({
                'chrom': chrom,
                'pos': pos,
                'ref': ref,
                'alt': alt,
                'qual': qual,
                'type': variant_type,
                'depth': dp
            })
    
    return pd.DataFrame(variants)

def plot_variant_analysis(df):
    """ë³€ì´ ë¶„ì„ ê²°ê³¼ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤."""
    
    fig, axes = plt.subplots(2, 2, figsize=(15, 12))
    
    # ë³€ì´ ìœ í˜•ë³„ ê°œìˆ˜
    type_counts = df['type'].value_counts()
    axes[0, 0].pie(type_counts.values, labels=type_counts.index, autopct='%1.1f%%')
    axes[0, 0].set_title('ë³€ì´ ìœ í˜•ë³„ ë¶„í¬')
    
    # ì—¼ìƒ‰ì²´ë³„ ë³€ì´ ê°œìˆ˜
    chrom_counts = df['chrom'].value_counts().head(10)
    axes[0, 1].bar(range(len(chrom_counts)), chrom_counts.values)
    axes[0, 1].set_xticks(range(len(chrom_counts)))
    axes[0, 1].set_xticklabels(chrom_counts.index, rotation=45)
    axes[0, 1].set_title('ì—¼ìƒ‰ì²´ë³„ ë³€ì´ ê°œìˆ˜ (ìƒìœ„ 10ê°œ)')
    axes[0, 1].set_ylabel('ë³€ì´ ê°œìˆ˜')
    
    # í’ˆì§ˆ ì ìˆ˜ ë¶„í¬
    axes[1, 0].hist(df[df['qual'] > 0]['qual'], bins=50, alpha=0.7)
    axes[1, 0].set_title('ë³€ì´ í’ˆì§ˆ ì ìˆ˜ ë¶„í¬')
    axes[1, 0].set_xlabel('QUAL Score')
    axes[1, 0].set_ylabel('ë¹ˆë„')
    axes[1, 0].axvline(x=30, color='red', linestyle='--', 
                       label='í’ˆì§ˆ ì„ê³„ê°’ (Q30)')
    axes[1, 0].legend()
    
    # ê¹Šì´ ë¶„í¬
    depth_data = df[df['depth'] > 0]['depth']
    axes[1, 1].hist(depth_data, bins=50, alpha=0.7)
    axes[1, 1].set_title('ë³€ì´ ê¹Šì´ ë¶„í¬')
    axes[1, 1].set_xlabel('Read Depth')
    axes[1, 1].set_ylabel('ë¹ˆë„')
    axes[1, 1].axvline(x=depth_data.mean(), color='red', 
                       linestyle='--', label=f'í‰ê·  ê¹Šì´: {depth_data.mean():.1f}')
    axes[1, 1].legend()
    
    plt.tight_layout()
    plt.savefig('variant_analysis.png', dpi=300, bbox_inches='tight')
    plt.show()

def compare_variant_callers(gatk_file, bcftools_file):
    """ë‘ ë³€ì´ í˜¸ì¶œ ë°©ë²•ì„ ë¹„êµí•©ë‹ˆë‹¤."""
    
    print("ğŸ”¬ GATK vs bcftools ë³€ì´ í˜¸ì¶œ ë¹„êµ")
    print("=" * 60)
    
    # ê°ê° ë¶„ì„
    gatk_stats = analyze_vcf_statistics(gatk_file)
    bcftools_stats = analyze_vcf_statistics(bcftools_file)
    
    gatk_df = parse_vcf_variants(gatk_file)
    bcftools_df = parse_vcf_variants(bcftools_file)
    
    # ë¹„êµ í‘œ ìƒì„±
    comparison_data = {
        'Method': ['GATK', 'bcftools'],
        'Total_Variants': [len(gatk_df), len(bcftools_df)],
        'SNPs': [len(gatk_df[gatk_df['type'] == 'SNP']), 
                len(bcftools_df[bcftools_df['type'] == 'SNP'])],
        'INDELs': [len(gatk_df[gatk_df['type'] != 'SNP']), 
                  len(bcftools_df[bcftools_df['type'] != 'SNP'])],
        'Avg_Quality': [gatk_df[gatk_df['qual'] > 0]['qual'].mean(),
                       bcftools_df[bcftools_df['qual'] > 0]['qual'].mean()],
        'Avg_Depth': [gatk_df[gatk_df['depth'] > 0]['depth'].mean(),
                     bcftools_df[bcftools_df['depth'] > 0]['depth'].mean()]
    }
    
    comp_df = pd.DataFrame(comparison_data)
    print("\nğŸ“Š ë³€ì´ í˜¸ì¶œ ë°©ë²• ë¹„êµ:")
    print(comp_df.to_string(index=False))
    
    # ê²¹ì¹˜ëŠ” ë³€ì´ ë¶„ì„
    gatk_positions = set(zip(gatk_df['chrom'], gatk_df['pos']))
    bcftools_positions = set(zip(bcftools_df['chrom'], bcftools_df['pos']))
    
    overlap = len(gatk_positions & bcftools_positions)
    gatk_only = len(gatk_positions - bcftools_positions)
    bcftools_only = len(bcftools_positions - gatk_positions)
    
    print(f"\nğŸ¯ ë³€ì´ ìœ„ì¹˜ ê²¹ì¹¨ ë¶„ì„:")
    print(f"ê³µí†µ ë³€ì´: {overlap:,}")
    print(f"GATK ì „ìš©: {gatk_only:,}")
    print(f"bcftools ì „ìš©: {bcftools_only:,}")
    print(f"ê²¹ì¹¨ë¥ : {overlap/len(gatk_positions | bcftools_positions)*100:.1f}%")
    
    return comp_df

# ë¶„ì„ ì‹¤í–‰
gatk_file = '/home/ubuntu/edu/raw_data/variant_calling/soybean_gatk.vcf.gz'
bcftools_file = '/home/ubuntu/edu/raw_data/variant_calling/soybean_bcftools.vcf.gz'

# ê°œë³„ ë¶„ì„
print("ğŸ§¬ GATK ë³€ì´ í˜¸ì¶œ í†µê³„:")
print("=" * 50)
gatk_stats = analyze_vcf_statistics(gatk_file)
for key, value in gatk_stats.items():
    if 'number of' in key.lower() or 'SNPs' in key or 'indels' in key:
        print(f"{key}: {value}")

gatk_df = parse_vcf_variants(gatk_file)
print(f"\nğŸ“Š GATK ìƒì„¸ ë¶„ì„:")
print(f"ì´ ë³€ì´ ìˆ˜: {len(gatk_df):,}")
print(f"SNP: {len(gatk_df[gatk_df['type'] == 'SNP']):,}")
print(f"Insertion: {len(gatk_df[gatk_df['type'] == 'Insertion']):,}")
print(f"Deletion: {len(gatk_df[gatk_df['type'] == 'Deletion']):,}")
print(f"í‰ê·  í’ˆì§ˆ ì ìˆ˜: {gatk_df[gatk_df['qual'] > 0]['qual'].mean():.2f}")
print(f"í‰ê·  ê¹Šì´: {gatk_df[gatk_df['depth'] > 0]['depth'].mean():.1f}")

# ë¹„êµ ë¶„ì„
comparison_results = compare_variant_callers(gatk_file, bcftools_file)

# ì‹œê°í™” (GATK ê²°ê³¼)
plot_variant_analysis(gatk_df)
</div>
            </div>
        </div>

        <div class="result-box">
            <h4><i class="fas fa-chart-bar"></i> ì˜ˆìƒ ê²°ê³¼</h4>
            <div class="terminal-output">
ğŸ§¬ GATK ë³€ì´ í˜¸ì¶œ í†µê³„:
==================================================
number of records: 15,234
number of SNPs: 12,456
number of indels: 2,778
number of multiallelic sites: 342

ğŸ“Š GATK ìƒì„¸ ë¶„ì„:
ì´ ë³€ì´ ìˆ˜: 15,234
SNP: 12,456
Insertion: 1,389
Deletion: 1,389
í‰ê·  í’ˆì§ˆ ì ìˆ˜: 45.6
í‰ê·  ê¹Šì´: 28.3

ğŸ”¬ GATK vs bcftools ë³€ì´ í˜¸ì¶œ ë¹„êµ
============================================================
ğŸ“Š ë³€ì´ í˜¸ì¶œ ë°©ë²• ë¹„êµ:
   Method  Total_Variants   SNPs  INDELs  Avg_Quality  Avg_Depth
     GATK           15234  12456    2778         45.6       28.3
 bcftools           18567  14892    3675         38.2       26.8

ğŸ¯ ë³€ì´ ìœ„ì¹˜ ê²¹ì¹¨ ë¶„ì„:
ê³µí†µ ë³€ì´: 13,845
GATK ì „ìš©: 1,389
bcftools ì „ìš©: 4,722
ê²¹ì¹¨ë¥ : 81.2%
            </div>
        </div>

        <h2>ğŸ·ï¸ 5ë‹¨ê³„: ë³€ì´ ì£¼ì„ (SnpEff)</h2>
        <div class="practical-box">
            <h3><i class="fas fa-tags"></i> ë³€ì´ ê¸°ëŠ¥ ì˜ˆì¸¡ ë° ì£¼ì„</h3>
            <p>SnpEffë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€ì´ê°€ ìœ ì „ìì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤.</p>
            
            <div class="code-block-container">
                <div class="code-block bash">
# SnpEff ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸ (ì½© ê²Œë†ˆ)
snpEff databases | grep -i glycine

# ë³€ì´ ì£¼ì„ ì‹¤í–‰ (ì˜ˆì‹œ: ì¼ë°˜ì ì¸ ì‹ë¬¼ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©)
snpEff -v Glycine_max \
    variant_calling/soybean_raw.vcf.gz > \
    variant_calling/soybean_annotated.vcf

# ì£¼ì„ í†µê³„ í™•ì¸
snpEff -stats variant_calling/snpEff_summary.html \
    Glycine_max \
    variant_calling/soybean_raw.vcf.gz > \
    variant_calling/soybean_annotated.vcf
</div>
            </div>
        </div>

        <div class="variant-types">
            <h4><i class="fas fa-dna"></i> ë³€ì´ ê¸°ëŠ¥ ë¶„ë¥˜</h4>
            <div class="comparison-table">
                <div class="comparison-item" style="border-left-color: #dc3545;">
                    <h4>ë†’ì€ ì˜í–¥ (HIGH)</h4>
                    <ul>
                        <li><strong>STOP_GAINED:</strong> ì¡°ê¸° ì¢…ë£Œ ì½”ëˆ</li>
                        <li><strong>STOP_LOST:</strong> ì¢…ë£Œ ì½”ëˆ ì†ì‹¤</li>
                        <li><strong>START_LOST:</strong> ì‹œì‘ ì½”ëˆ ì†ì‹¤</li>
                        <li><strong>FRAME_SHIFT:</strong> í”„ë ˆì„ì‹œí”„íŠ¸ ëŒì—°ë³€ì´</li>
                    </ul>
                </div>
                
                <div class="comparison-item" style="border-left-color: #f39c12;">
                    <h4>ì¤‘ê°„ ì˜í–¥ (MODERATE)</h4>
                    <ul>
                        <li><strong>MISSENSE:</strong> ì•„ë¯¸ë…¸ì‚° ë³€í™”</li>
                        <li><strong>CODON_DELETION:</strong> ì½”ëˆ ê²°ì‹¤</li>
                        <li><strong>CODON_INSERTION:</strong> ì½”ëˆ ì‚½ì…</li>
                        <li><strong>SPLICE_SITE:</strong> ìŠ¤í”Œë¼ì´ì‹± ë¶€ìœ„</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="exercise-box">
            <h3><i class="fas fa-tasks"></i> ì‹¤ìŠµ ê³¼ì œ</h3>
            <ol>
                <li>GATKì™€ bcftools ë³€ì´ í˜¸ì¶œ ì„±ê³µë¥ ì„ ë¹„êµí•˜ì„¸ìš”</li>
                <li>ë‘ ë°©ë²•ì—ì„œ SNPì™€ INDELì˜ ë¹„ìœ¨ ì°¨ì´ë¥¼ ë¶„ì„í•˜ì„¸ìš”</li>
                <li>í’ˆì§ˆ ì ìˆ˜ ë¶„í¬ë¥¼ í™•ì¸í•˜ê³  ê° ë°©ë²•ì˜ í•„í„°ë§ ê¸°ì¤€ì„ ì„¤ì •í•˜ì„¸ìš”</li>
                <li>ì—¼ìƒ‰ì²´ë³„ ë³€ì´ ë°€ë„ë¥¼ ë‘ ë°©ë²•ìœ¼ë¡œ ë¹„êµ ë¶„ì„í•˜ì„¸ìš”</li>
                <li>ê³µí†µ ë³€ì´ì™€ ë°©ë²•ë³„ íŠ¹ì´ ë³€ì´ì˜ íŠ¹ì„±ì„ ë¶„ì„í•˜ì„¸ìš”</li>
                <li>ì²˜ë¦¬ ì‹œê°„ê³¼ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ë¹„êµí•´ë³´ì„¸ìš”</li>
                <li>ì£¼ì„ëœ ë³€ì´ ì¤‘ ê¸°ëŠ¥ì  ì˜í–¥ì´ í° ë³€ì´ë¥¼ ì°¾ì•„ë³´ì„¸ìš”</li>
            </ol>
        </div>

        <div class="statistics-box">
            <h4><i class="fas fa-info-circle"></i> ì‹ë¬¼ ê²Œë†ˆ ë³€ì´ í˜¸ì¶œ íŠ¹ì„±</h4>
            <ul>
                <li><strong>SNP ë°€ë„:</strong> ì½© ê²Œë†ˆì—ì„œ ì•½ 1-5 SNP/kb ì˜ˆìƒ</li>
                <li><strong>INDEL ë¹„ìœ¨:</strong> ì „ì²´ ë³€ì´ì˜ 15-25% ì •ë„</li>
                <li><strong>Ti/Tv ë¹„ìœ¨:</strong> Transition/Transversion ì•½ 2.0-2.5</li>
                <li><strong>ì´í˜•ì ‘í•©ë„:</strong> ìê°€ìˆ˜ë¶„ ì‹ë¬¼ì—ì„œ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ìŒ</li>
            </ul>
        </div>

        <div class="warning-box">
            <h4><i class="fas fa-exclamation-triangle"></i> ì£¼ì˜ì‚¬í•­</h4>
            <ul>
                <li><strong>ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰:</strong> GATKëŠ” ëŒ€ìš©ëŸ‰ ë©”ëª¨ë¦¬ í•„ìš” (8GB ì´ìƒ ê¶Œì¥)</li>
                <li><strong>ì²˜ë¦¬ ì‹œê°„:</strong> ê²Œë†ˆ í¬ê¸°ì— ë”°ë¼ ìˆ˜ì‹œê°„ ì†Œìš” ê°€ëŠ¥</li>
                <li><strong>ì„ì‹œ íŒŒì¼:</strong> ì¶©ë¶„í•œ ë””ìŠ¤í¬ ê³µê°„ í™•ë³´ í•„ìš”</li>
                <li><strong>ì°¸ì¡° ê²Œë†ˆ í’ˆì§ˆ:</strong> ë†’ì€ í’ˆì§ˆì˜ ì°¸ì¡° ê²Œë†ˆ ì‚¬ìš© ì¤‘ìš”</li>
                <li><strong>BAM í’ˆì§ˆ:</strong> ì •ë ¬ í’ˆì§ˆì´ ë³€ì´ í˜¸ì¶œ ì •í™•ë„ì— ì§ì ‘ ì˜í–¥</li>
            </ul>
        </div>
    </div>
</div>

<div class="navigation">
    <button class="nav-btn" onclick="window.location.href='slide06.html'">â—€ ì´ì „</button>
    <button class="nav-btn" onclick="window.location.href='slide08.html'">ë‹¤ìŒ â–¶</button>
    <button class="fullscreen-btn" onclick="toggleFullscreen()">â›¶</button>
    <button class="jump-btn" onclick="jumpToSlide()">ì´ë™</button>
</div>

<div class="slide-number">ìŠ¬ë¼ì´ë“œ 7</div>

<script>
    function prevSlide() {
        window.location.href = "slide06.html";
    }
    
    function nextSlide() {
        window.location.href = "slide08.html";
    }
    
    function jumpToIndex() {
        window.location.href = "index.html";
    }
    
    function toggleFullscreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }
    }
    
    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowRight' || e.key === ' ') {
            nextSlide();
        } else if (e.key === 'ArrowLeft') {
            prevSlide();
        } else if (e.key === 'Home') {
            jumpToIndex();
        } else if (e.key === 'F11') {
            e.preventDefault();
            toggleFullscreen();
        }
    });
    
    // Syntax highlighting function
    function highlightCode() {
        const codeBlocks = document.querySelectorAll('.code-block');
        
        codeBlocks.forEach(block => {
            const code = block.textContent;
            const language = block.classList.contains('python') ? 'python' : 
                           block.classList.contains('bash') ? 'bash' : 'python'; // default to python
            
            const highlightedCode = highlightSyntax(code, language);
            block.innerHTML = highlightedCode;
            
            // Add copy button
            addCopyButton(block, code);
        });
    }
    
    // Add copy button to code block
    function addCopyButton(codeBlock, originalCode) {
        // Check if copy button already exists
        const container = codeBlock.parentElement;
        if (container && container.querySelector('.copy-button')) {
            return; // Copy button already exists
        }
        
        const copyButton = document.createElement('button');
        copyButton.className = 'copy-button';
        copyButton.textContent = 'Copy';
        copyButton.title = 'Copy code to clipboard';
        
        copyButton.addEventListener('click', function() {
            copyToClipboard(originalCode, copyButton);
        });
        
        // Append to container if it exists, otherwise to code block
        if (container && container.classList.contains('code-block-container')) {
            container.appendChild(copyButton);
        } else {
            codeBlock.style.position = 'relative'; // Ensure positioning context
            codeBlock.appendChild(copyButton);
        }
    }
    
    // Copy text to clipboard
    function copyToClipboard(text, button) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            // Modern approach
            navigator.clipboard.writeText(text).then(function() {
                showCopySuccess(button);
            }).catch(function() {
                fallbackCopyToClipboard(text, button);
            });
        } else {
            // Fallback for older browsers
            fallbackCopyToClipboard(text, button);
        }
    }
    
    // Fallback copy method
    function fallbackCopyToClipboard(text, button) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        textArea.style.top = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            document.execCommand('copy');
            showCopySuccess(button);
        } catch (err) {
            console.error('Copy failed:', err);
        }
        
        document.body.removeChild(textArea);
    }
    
    // Show copy success feedback
    function showCopySuccess(button) {
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        button.classList.add('copied');
        
        setTimeout(function() {
            button.textContent = originalText;
            button.classList.remove('copied');
        }, 2000);
    }
    
    function highlightSyntax(code, language) {
        if (language === 'python') {
            return highlightPython(code);
        } else if (language === 'bash') {
            return highlightBash(code);
        }
        return code;
    }
    
    function highlightPython(code) {
        let highlighted = code;
        
        // 1. Highlight strings first
        highlighted = highlighted.replace(/"[^"]*"/g, '<span class="string">$&</span>');
        highlighted = highlighted.replace(/'[^']*'/g, '<span class="string">$&</span>');
        
        // 2. Highlight comments
        highlighted = highlighted.replace(/#.*$/gm, '<span class="comment">$&</span>');
        
        // 3. Highlight keywords
        const keywords = ['import', 'from', 'def', 'if', 'else', 'elif', 'for', 'while', 'try', 'except', 'with', 'as', 'return', 'and', 'or', 'not', 'in', 'is', 'True', 'False', 'None'];
        keywords.forEach(keyword => {
            const regex = new RegExp(`\\b${keyword}\\b`, 'g');
            highlighted = highlighted.replace(regex, `<span class="keyword">${keyword}</span>`);
        });
        
        // 4. Highlight built-in functions
        const builtins = ['print', 'len', 'open', 'range', 'enumerate', 'gzip', 'os', 'plt', 'np', 'Counter'];
        builtins.forEach(builtin => {
            const regex = new RegExp(`\\b${builtin}\\b`, 'g');
            highlighted = highlighted.replace(regex, `<span class="builtin">${builtin}</span>`);
        });
        
        // 5. Highlight function definitions
        highlighted = highlighted.replace(/\b(def\s+)(\w+)/g, '$1<span class="function">$2</span>');
        
        // 6. Highlight numbers
        highlighted = highlighted.replace(/\b\d+\b/g, '<span class="number">$&</span>');
        
        return highlighted;
    }
    
    function highlightBash(code) {
        const keywords = ['if', 'then', 'else', 'elif', 'fi', 'for', 'while', 'do', 'done', 'case', 'esac', 'function', 'return', 'local', 'export', 'echo', 'cd', 'ls', 'mkdir', 'cp', 'mv', 'rm', 'chmod', 'chown', 'grep', 'sed', 'awk', 'sort', 'uniq', 'wc', 'cat', 'head', 'tail'];
        
        // Split into lines to process line by line (avoids conflicts)
        const lines = code.split('\n');
        const highlightedLines = [];
        
        for (let line of lines) {
            let highlighted = line;
            
            // Skip if line is empty
            if (!highlighted.trim()) {
                highlightedLines.push(highlighted);
                continue;
            }
            
            // 1. Highlight shebang
            if (highlighted.match(/^#!/)) {
                highlighted = highlighted.replace(/^(#!.*)$/, '<span class="shebang">$1</span>');
                highlightedLines.push(highlighted);
                continue;
            }
            
            // 2. Highlight full-line comments
            if (highlighted.trim().startsWith('#')) {
                highlighted = highlighted.replace(/^(\s*)(#.*)$/, '$1<span class="comment">$2</span>');
                highlightedLines.push(highlighted);
                continue;
            }
            
            // 3. Highlight strings
            highlighted = highlighted.replace(/("[^"]*")/g, '<span class="string">$1</span>');
            highlighted = highlighted.replace(/('[^']*')/g, '<span class="string">$1</span>');
            
            // 4. Highlight inline comments (after code)
            highlighted = highlighted.replace(/(\s+)(#.*)$/, '$1<span class="comment">$2</span>');
            
            // 5. Highlight variables
            highlighted = highlighted.replace(/(\$\w+)/g, '<span class="variable">$1</span>');
            
            // 6. Highlight keywords
            keywords.forEach(keyword => {
                const regex = new RegExp(`\\b${keyword}\\b`, 'g');
                highlighted = highlighted.replace(regex, `<span class="keyword">${keyword}</span>`);
            });
            
            highlightedLines.push(highlighted);
        }
        
        return highlightedLines.join('\n');
    }
    
    // Apply syntax highlighting when page loads
    document.addEventListener('DOMContentLoaded', highlightCode);
</script>

</body>
</html>